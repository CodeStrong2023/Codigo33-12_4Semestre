<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <title>Pago con Mercado Pago</title>
</head>
<body>
    <!--shop content-->
    <div class="card-products-container">
        <div class="card-products" id="shopContent"></div>
    </div>
    <!--cart btn-->
    <div class="cart-btn" id="cart-btn">ðŸ›’</div>
    <!--cart counter-->
    <span class="cart-counter" id="cart-counter">0</span>
    <!--modal-->
    <div class="modal-overlay" id="modal-overlay"></div>
    <div class="modal-container" id="modal-container"></div>

    <!--Contenedor para el brick de Mercado Pago-->
    <div id="wallet_container"></div>

    <script src="../js/products.js"></script>
    <script src="../js/index.js"></script>
    <script src="../js/cart.js"></script>

    <!--Inicializacion del widget de Mercado Pago-->
    <script>
        const mp = new MercadoPago("YOUR_PUBLIC_KEY", {
            locale: 'es-AR'
        });

        // Funcion para crear la preferencia de pago
        const setupPayment = async () => {
            try {
                const response = await fetch('/create_preference', {
                    method: "POST",
                    headers: {
                        "content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        description: "Tu producto",
                        price: 2000,
                        quanty: 1
                    })
                });

                const data = await response.json();
                const preferenceId = data.id;

                //Configura el brick de wallet
                mp.bricks().create("wallet", "#wallet_container", {
                    initialization: {
                        preferenceId: preferenceId,
                    },
                });
            }catch (error) {
                console.error("Error al obtener la preferencia:", error);
            }
        };

        // Ejecuta la funcion cuando el documento este listo
        document.addEventListener("DOMContentLoaded", setupPayment);
    </script>
</body>
</html>